#Production mode
vault server -config=config.hcl
vault server -config=config-tls.hcl

set VAULT_ADDR=http://127.0.0.1:8200
set VAULT_ADDR=https://127.0.0.1:8200
set VAULT_CACERT=certs/root.crt
set VAULT_CLIENT_CERT=certs/vault-client.crt
set VAULT_CLIENT_KEY=certs/vault-client.key
set VAULT_TOKEN=hvs.KTUgeupMpVklqEM2B4mXDgkI

export VAULT_ADDR=http://127.0.0.1:8200
export VAULT_ADDR=https://127.0.0.1:8200
export VAULT_CACERT=certs/root.crt
export VAULT_CLIENT_CERT=certs/vault-client.crt
export VAULT_CLIENT_KEY=certs/vault-client.key
export VAULT_TOKEN=hvs.KTUgeupMpVklqEM2B4mXDgkI

vault operator init

Unseal Key 1: hRJmFYnCx9hcwtxNUCtuL528i22AeNlqo9rV9elAiTH/
Unseal Key 2: xo/zWi9a3iwY/igh5ByuPxo3/ydx06oeYs3ko/ugvSVq
Unseal Key 3: MQXL8G4SaAPxN4XqB5QdpgQ4u6ptv/clO2PAOngM8BZf
Unseal Key 4: GkzTbvxmXx6mFi+5J96ApeQLPlsnEaKcQT1PiFXD1Hj3
Unseal Key 5: DQrHDupLH33Ho5UcnkaSgfJ1tuq2TD68fT+zExpgysAd

Initial Root Token: hvs.KTUgeupMpVklqEM2B4mXDgkI
hvs.CAESIHtNz4UejDl8mbWcoEWZqGSakNivnkJ9koJldjJXDgTrGh4KHGh2cy5vbW5KTDVla2NiR0J5MjBTU1FVSUNjNDI
chrome://net-internals/#hsts
vault operator unseal
vault operator seal
vault login
vault status
vault secrets list -detailed
vault roles list -detailed
vault policy list

vault secrets enable -path=secret/ kv
vault secrets disable secret/

vault auth disable approle

set VAULT_TOKEN=hvs.EYKmnkVqDUs5l8HSHDgmjlSQ
set VAULT_TOKEN=

vault write secret/credentials username="daniel" password="test"
vault write auth/approle/role/app policies=token-policy

vault operator unseal
terraform init
terraform init -upgrade
terraform apply
terraform plan -target=module.enable
terraform plan -target=module.config

vault token create -policy=token-policy -role=tokenrole -orphan -renewable=true -ttl="768h" -display-name="api-token" 

vault token create -role=tokenrole -display-name="api-token" 

vault token revoke -accessor JSNRvemGD3kFDYR5E1K60GEm
vault list auth/token/accessors
vault list auth/approle/role
vault list auth/token/roles

vault token revoke -mode=path auth/token
vault token lookup hvs.CAESID0tknV6nthYjmv2RV-_Q9Dg9EDNRi3B_w2E6Z6-hn9lGh4KHGh2cy5yZkVtWkw2ZHlyeUNjZU5LYUJjeElqUGU
vault token lookup -accessor b8vCXa1rZAXYX2Tf810EzJcE

vault token renew -accessor CoFWXsWBzsntpm5wmdQ79U8w
vault token renew hvs.CAESID0tknV6nthYjmv2RV-_Q9Dg9EDNRi3B_w2E6Z6-hn9lGh4KHGh2cy5yZkVtWkw2ZHlyeUNjZU5LYUJjeElqUGU


vault delete auth/approle/role/app
vault delete auth/approle/role/app2

curl -H "X-Vault-Token: hvs.CAESID0tknV6nthYjmv2RV-_Q9Dg9EDNRi3B_w2E6Z6-hn9lGh4KHGh2cy5yZkVtWkw2ZHlyeUNjZU5LYUJjeElqUGU" -X GET http://127.0.0.1:8200/v1/secret/aws-access
curl -H "X-Vault-Token: hvs.CAESIA71O__2HZctLUATM_xpM_8OU2XMpU4lbe5C8Ja5o_utGh4KHGh2cy45WG5WR3dQRWMzSFFIY1B5dEw2a3RST1o" -X GET http://127.0.0.1:8200/v1/secret/aws-access

https://registry.terraform.io/providers/hashicorp/vault/latest/docs/resources/token_auth_backend_role#token_explicit_max_ttl


curl --header "X-Vault-Token: hvb.AAAAAQLhxRG7XFB75yRTJFlDGsIYd7nw4JtLunDJVtvaVs536lkC1SV3F4qhfy1GQRJ6ux2RRkKT9ThPNSbW_C-EQNHJWIK7jFnsNwTpU-_N3tHyBUSJGCk5B2vc1vY0lWDoXc8XUNRc5RhCg55civy3pOvC55STLntgSv0GwkzKRaHwNxHd7EpiB8-TkrW33tEsQ3C9EvbVtOOYH7Tw1V1rJPN8qnqnFLIQwafvQkb4KOtJlgss4kP4CsMA8k_x1_AHemLdGXh-jb7D1TqtSTCUQ0fEx4XSIJitwIqHgfSbuECVD6zXonPQl7YiLjLLrvw8ErCVbTV9pwaoUP4HRmz7iWR-29w2ElVTkzO_p49r-4FOzfsul4g99zb6gz0Xkdi4KDWX-qf10thE-oorFJbTALJlvwKL7VLl1gKxFcv4JQ" --request POST http://127.0.0.1:8200/v1/auth/token/renew-self
curl --header "X-Vault-Token: hvs.RpXtV43cGcqbHklqD5W9dUHz" --request POST --data @payload.json http://127.0.0.1:8200/v1/auth/token/renew
curl -X POST -H "Content-Type: application/json" -d "{ \"password\": \"salt\" }" http://127.0.0.1:8200/v1/auth/userpass/login/daniel

curl -X POST -H "Content-Type: application/json" -d "{ \"password\": \"salt\" }" http://127.0.0.1:8200/v1/auth/userpass/login/daniel

vault auth enable userpass
vault auth disable userpass

vault write auth/userpass/users/test policies=default password=test


vault write auth/userpass/users/daniel policies=default password=salt



vault read identity/entity/id/326b8881-f813-3c45-f72c-abb6051567fb
vault read identity/oidc/client/cube

https://discuss.hashicorp.com/t/identity-entity-must-be-associated-with-the-request/48900/2

curl -X POST -H "Content-Type: application/json" -d "{ \"password\": \"salt\" }" http://127.0.0.1:8200/v1/auth/userpass/login/daniel
curl --request GET --location --header "X-Vault-Token: hvs.CAESIPV1dLrtaiC5Fmz22U9LXf9JGsa5aYc0lJODZjdxdd5eGh4KHGh2cy5mNmZiMEpJZ0NzdUVjdldQY3UyZEpOaEQ" "http://localhost:8200/v1/identity/oidc/provider/default/authorize?client_id=Y0DhaerCUBifYOYta9bMdHbLaJQk487k&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foidc%2Fcallback&response_type=code&scope=openid&state=aaa"
curl --request GET --location --header "X-Vault-Token: hvs.CAESIPV1dLrtaiC5Fmz22U9LXf9JGsa5aYc0lJODZjdxdd5eGh4KHGh2cy5mNmZiMEpJZ0NzdUVjdldQY3UyZEpOaEQ" "http://localhost:8200/v1/identity/oidc/provider/default/token"


curl --request GET --location --header "X-Vault-Token: hvs.CAESIPV1dLrtaiC5Fmz22U9LXf9JGsa5aYc0lJODZjdxdd5eGh4KHGh2cy5mNmZiMEpJZ0NzdUVjdldQY3UyZEpOaEQ" "http://localhost:8200/ui/vault/identity/oidc/provider/default/authorize?client_id=Y0DhaerCUBifYOYta9bMdHbLaJQk487k&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foidc%2Fcallback&response_type=code&scope=openid&state=aaa"

hvs.CAESIIs_387ljBjA9HcxH12Xbvgi_AItEH2WBhutcWYcWx6DGh4KHGh2cy43WnRZN29ETmVEYzhReHhrdWhkUmlRZHA

https://www.reddit.com/r/hashicorp/comments/13fnvv9/hashicorp_vault_oidc_provider/

http://localhost:8080/oidc/token?code=W0KcsvOdFB9qolyq0HTH2Cri5493e4SI

http://localhost:8200/ui/vault/identity/oidc/provider/default/authorize?client_id=giuwUMpQx9zOP8qv2iZLCXlfys7Q1okq&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foidc%2Fcallback&response_type=code&scope=openid


curl --header "X-Vault-Token: hvs.CAESIFNzx8JFufN-tJnqDkkl46vFi1z7DEyuYjMeaaw-ngf7Gh4KHGh2cy5jNHdXM1ZLVE9BRTN1d3JoWUdGd21SZ3g" http://127.0.0.1:8200/v1/identity/entity/id/326b8881-f813-3c45-f72c-abb6051567fb


vault write identity/group name="engineering" member_entity_ids="0dbc1ebe-cdf8-e1cc-fcf5-0497eebdb2e1"


vault write identity/oidc/assignment/my-assignment group_ids="7ba5147c-31bd-f24a-3461-43170e9c60b9" entity_ids="326b8881-f813-3c45-f72c-abb6051567fb"

    \"username\": {{identity.entity.aliases.$MOUNT_ACCESSOR.name}},\"contact\": {\"mail\": {{identity.entity.metadata.email}}}

vault write identity/oidc/scope/user description="Scope for user metadata" template={\"username\": {{identity.entity.metadata.mail}}}


vault write identity/oidc/scope/user description="Scope for user metadata" template="\"username\": {{identity.entity.aliases.$MOUNT_ACCESSOR.name}}",\"contact\": {\"mail\": {{identity.entity.metadata.email}}}"
vault write identity/oidc/scope/groups description="Scope for groups metadata" template="{\"groups\": \"engineering\"}"

vault write identity/oidc/key/my-key allowed_client_ids="*" verification_ttl="1h" rotation_period="1h" algorithm="RS256"
vault write identity/oidc/client/cube2 redirect_uris="http://localhost:8080/oidc/callback" assignments="my-assignment" key="my-key" id_token_ttl="30m" access_token_ttl="1h"


vault write identity/oidc/provider/my-provider allowed_client_ids="*" scopes_supported="user"

vault write identity/oidc/provider/my-provider allowed_client_ids="EUiWeZLFQPpybbKwpOMYmAYN40jqdKvj" scopes_supported="groups,user"


curl --request GET --location --header "X-Vault-Token: hvs.CAESIPcpyqEJsSkQ9_GItbUcLy6rzvDBn9xdP12Itzq2Y25xGh4KHGh2cy5GdE9oWXlPZnJMUXVwbnlWVzVmcmJHT0c" "http://localhost:8200/v1/identity/oidc/provider/default/authorize?client_id=EUiWeZLFQPpybbKwpOMYmAYN40jqdKvj&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Foidc%2Fcallback&response_type=code&scope=openid%20user&state=aaa"


http://localhost:8080/oidc/token?code=BcMLRAtxxoHFpLE7oVxl86FwVEo4Jnfa

###Get Moount Accsseor
vault auth list -detailed


###scopes 
 -user
 { "user": { 
            "name": {{identity.entity.aliases.auth_userpass_7e1d4583.name}},
            "mail": {{identity.entity.metadata.mail}}
          }
}

-groups 
{"groups": {{identity.entity.groups.names}}}

https://brian-candler.medium.com/using-vault-as-an-openid-connect-identity-provider-ee0aaef2bba2
https://developer.hashicorp.com/vault/tutorials/auth-methods/oidc-identity-provider
https://localhost:8200/ui/vault/identity/oidc/provider/my-provider/authorize?with=github
chrome://net-internals/#hsts