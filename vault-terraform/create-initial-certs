mkdir -p certs

openssl genrsa -out certs/root.key 4096
openssl req -x509 -new -nodes -key certs/root.key -sha256 -days 3650 -out certs/root.crt -subj "/CN=Vault Root CA/OU=Development/C=DE/ST=Saxonia/L=Leipzig/O=Main Gruppe" -addext "keyUsage = cRLSign, keyCertSign" -addext "extendedKeyUsage=serverAuth, clientAuth" 
cat certs/root.key certs/root.crt > certs/root.pem

openssl req -new -newkey rsa:4096 -nodes -keyout certs/vault-int.key -out certs/vault-int.csr -subj "/CN=Vault Intermediate/OU=Development/C=DE/ST=Saxonia/L=Leipzig/O=Main Gruppe" -addext "subjectAltName=DNS:localhost,IP:127.0.0.1" -addext "keyUsage = cRLSign, keyCertSign, digitalSignature" -addext "extendedKeyUsage=clientAuth,serverAuth"
openssl x509 -req -CA certs/root.crt -CAkey certs/root.key -CAcreateserial -in certs/vault-int.csr -out certs/vault-int.crt -days 3650 -extfile <(printf "subjectAltName=DNS:localhost,IP:127.0.0.1\nbasicConstraints=critical,CA:TRUE\nextendedKeyUsage=clientAuth,serverAuth\nkeyUsage = cRLSign, keyCertSign,digitalSignature")
cat certs/vault-int.crt certs/vault-int.key certs/root.crt > vault-int.pem

openssl req -new -newkey rsa:4096 -nodes -keyout certs/daniel.key -out certs/daniel.csr -subj "/CN=Daniel Pohl/OU=Development/C=DE/ST=Saxonia/L=Leipzig/O=Main Gruppe" -addext "subjectAltName=DNS:localhost,IP:127.0.0.1" -addext "keyUsage = cRLSign, keyCertSign, digitalSignature" -addext "extendedKeyUsage=clientAuth"
openssl x509 -req -CA certs/vault-int.crt -CAkey certs/vault-int.key -CAcreateserial -in certs/daniel.csr -out certs/daniel.crt -days 3650 -extfile <(printf "subjectAltName=DNS:localhost,IP:127.0.0.1\nbasicConstraints=critical,CA:FALSE\nextendedKeyUsage=clientAuth\nkeyUsage = keyAgreement,digitalSignature")

#create pkcs12 without passwort
cat certs/daniel.crt certs/daniel.key certs/vault-int.crt certs/root.crt > certs/daniel.pem
openssl pkcs12 -export -out certs/daniel.p12 -inkey certs/daniel.key -in certs/daniel.pem  -name "Daniel Pohl" -passout pass: